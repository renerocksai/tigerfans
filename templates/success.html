{% extends "base.html" %}
{% block title %}Payment ‚Äî TigerFans{% endblock %}

{% block content %}
<div class="glass squircle p-6">
  <h2 class="text-2xl font-semibold">Thanks! We‚Äôre confirming your payment‚Ä¶</h2>
  <p id="status" class="mt-2 text-slate-300">Order: {{ order_id }}</p>
  <div id="tickets" class="mt-6"></div>
  <div class="mt-6 flex gap-3">
    <a href="/demo/checkout" class="px-4 py-2 squircle glass hover:bg-white/10 transition">Back to tickets</a>
    <a href="/admin" class="px-4 py-2 squircle bg-brand-500 hover:bg-brand-400 transition">Open admin</a>
  </div>
</div>

<script>
  const orderId = {{ order_id|tojson }};
  async function tick() {
    const res = await fetch(`/api/orders/${orderId}`);
    const j = await res.json();
    document.getElementById('status').innerText = `Status: ${j.status}`;
    if (j.status === 'PAID') {
      const t = j.tickets || [];
      document.getElementById('tickets').innerHTML =
        `<h3 class="text-xl font-semibold mb-2">Your tickets</h3>` +
        `<ul class="space-y-2">` +
        t.map(x=>`<li class="p-2 squircle bg-slate-900 border border-white/10">${x}</li>`).join('') +
        `</ul>` + (j.got_goodie ? '<p class="mt-4">üéÅ Bonus granted!</p>':'');
      clearInterval(timer);
    } else if (j.status === 'PAID_UNFULFILLED') {
      document.getElementById('tickets').innerHTML =
        '<p class="text-amber-300">Payment received but tickets are no longer available. We will reconcile or refund.</p>';
      clearInterval(timer);
    } else if (j.status === 'FAILED' || j.status === 'CANCELED') {
      document.getElementById('tickets').innerHTML =
        '<p class="text-rose-300">Payment did not complete (reservation expired or canceled).</p>';
      clearInterval(timer);
    }
  }
  const timer = setInterval(tick, 1000);
  tick();
</script>
{% endblock %}
